<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PerfectPick | Smartphone Discovery Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #a855f7;
            --dark: #0f172a;
            --darker: #0a0f1c;
            --card: #1e293b;
            --card-hover: #334155;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            min-height: 100vh;
            color: #e2e8f0;
            overflow-x: hidden;
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .gradient-text {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 700;
        }

        .gradient-button {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.3);
        }

        .gradient-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }

        /* Enhanced Card Styles */
        .phone-card {
            background: linear-gradient(145deg, var(--card) 0%, rgba(30, 41, 59, 0.95) 100%);
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            overflow: hidden;
            position: relative;
        }

        .phone-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
        }

        .phone-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            border-color: rgba(99, 102, 241, 0.3);
        }

        .specs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin-top: 16px;
        }

        .spec-item {
            background: rgba(255, 255, 255, 0.03);
            padding: 12px;
            border-radius: 10px;
            border-left: 3px solid var(--primary);
            transition: all 0.3s ease;
        }

        .spec-item:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(4px);
        }

        .spec-label {
            font-size: 0.7rem;
            color: #94a3b8;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .spec-value {
            font-size: 0.85rem;
            color: #e2e8f0;
            font-weight: 600;
            margin-top: 4px;
        }

        .pulse-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary);
            animation: pulse 2s infinite;
        }

        .floating {
            animation: floating 6s ease-in-out infinite;
        }

        @keyframes floating {
            0% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
            100% { transform: translateY(0px) rotate(360deg); }
        }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }

        .fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .slide-in {
            animation: slideIn 0.6s ease-out forwards;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .search-bar {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .search-bar:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
            background: rgba(15, 23, 42, 0.9);
        }

        .suggestion-chip {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.2s ease;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .suggestion-chip:hover {
            background: rgba(99, 102, 241, 0.2);
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
        }

        .loading-bar {
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.4s ease;
            border-radius: 2px;
        }

        .feature-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
        }

        .result-counter {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .price-tag {
            background: linear-gradient(45deg, #10b981, #34d399);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .flipkart-badge {
            background: linear-gradient(45deg, #047bd5, #0a7bb8);
            color: white;
            padding: 0.4rem 1rem;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(4, 123, 213, 0.3);
        }

        .flipkart-button {
            background: linear-gradient(45deg, #047bd5, #0a7bb8);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(4, 123, 213, 0.3);
            font-size: 0.85rem;
        }

        .flipkart-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(4, 123, 213, 0.4);
            background: linear-gradient(45deg, #0369c1, #0967a6);
        }

        /* New Professional Elements */
        .section-title {
            position: relative;
            display: inline-block;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 60%;
            height: 3px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-radius: 2px;
        }

        .stats-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(168, 85, 247, 0.1));
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .feature-highlight {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(34, 197, 94, 0.1));
            border-left: 4px solid #10b981;
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, var(--primary-dark), var(--secondary));
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <!-- Enhanced Animated Background -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
        <div class="absolute -top-60 -right-60 w-96 h-96 bg-purple-500 rounded-full mix-blend-multiply filter blur-3xl opacity-5 animate-pulse floating"></div>
        <div class="absolute -bottom-60 -left-60 w-96 h-96 bg-indigo-500 rounded-full mix-blend-multiply filter blur-3xl opacity-5 animate-pulse floating" style="animation-delay: 2s;"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-blue-500 rounded-full mix-blend-multiply filter blur-3xl opacity-5 animate-pulse floating" style="animation-delay: 4s;"></div>
    </div>

    <div class="container max-w-7xl mx-auto relative z-10 flex-1 py-8 px-4">
        <!-- Enhanced Header -->
        <header class="text-center mb-16">
            <div class="flex items-center justify-center mb-6">
                <div class="feature-icon mr-3" style="box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);">
                    <i class="fas fa-magic text-white text-xl"></i>
                </div>
                <h1 class="text-5xl md:text-6xl font-bold gradient-text">PerfectPick</h1>
            </div>
            <p class="text-xl md:text-2xl text-gray-300 max-w-3xl mx-auto leading-relaxed">
                Discover your perfect smartphone with AI-powered recommendations
            </p>
            <div class="flex flex-col md:flex-row items-center justify-center mt-6 space-y-4 md:space-y-0 md:space-x-6">
                <div class="flipkart-badge flex items-center">
                    <i class="fas fa-database mr-2"></i>
                    Powered by Flipkart Data
                </div>
                <div class="flex items-center text-gray-400 bg-gray-800/50 px-4 py-2 rounded-full">
                    <div class="pulse-dot mr-3"></div>
                    <span class="text-sm font-medium">Real-time AI Analysis</span>
                </div>
            </div>
        </header>

        <!-- Stats Section -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
            <div class="stats-card glass-card rounded-2xl p-6 text-center">
                <i class="fas fa-robot text-2xl text-indigo-400 mb-3"></i>
                <h3 class="text-lg font-semibold text-white mb-2">AI-Powered</h3>
                <p class="text-gray-400 text-sm">Advanced machine learning algorithms</p>
            </div>
            <div class="stats-card glass-card rounded-2xl p-6 text-center">
                <i class="fas fa-bolt text-2xl text-yellow-400 mb-3"></i>
                <h3 class="text-lg font-semibold text-white mb-2">Instant Results</h3>
                <p class="text-gray-400 text-sm">Get recommendations in seconds</p>
            </div>
            <div class="stats-card glass-card rounded-2xl p-6 text-center">
                <i class="fas fa-chart-line text-2xl text-green-400 mb-3"></i>
                <h3 class="text-lg font-semibold text-white mb-2">Data-Driven</h3>
                <p class="text-gray-400 text-sm">Based on real market data</p>
            </div>
        </div>

        <!-- Enhanced Search Section -->
        <section class="mb-12">
            <h2 class="section-title text-3xl font-bold text-white mb-8">Find Your Perfect Phone</h2>
            <div class="glass-card rounded-3xl p-8 mb-8">
                <div class="flex flex-col md:flex-row gap-6 items-center">
                    <div class="flex-1 relative w-full">
                        <div class="absolute left-5 top-1/2 transform -translate-y-1/2 text-gray-400">
                            <i class="fas fa-search text-lg"></i>
                        </div>
                        <input
                            type="text"
                            id="queryInput"
                            placeholder="Describe your ideal phone: 'Best camera under ₹30,000' or 'Gaming phone with 120Hz display'"
                            class="w-full pl-14 pr-6 py-5 rounded-2xl search-bar text-white placeholder-gray-400 focus:outline-none transition-all duration-300 text-lg"
                            aria-label="Enter your phone query"
                        />
                    </div>
                    <button
                        id="submitButton"
                        class="gradient-button text-white font-semibold py-5 px-10 rounded-2xl focus:outline-none focus:ring-3 focus:ring-indigo-500 flex items-center text-lg"
                        onclick="fetchRecommendations()"
                        aria-label="Get recommendations"
                    >
                        <i class="fas fa-robot mr-3"></i>
                        Find Phones
                    </button>
                </div>
                
                <!-- Enhanced Quick Suggestions -->
                <div class="mt-8">
                    <p class="text-gray-400 text-sm mb-4 font-semibold uppercase tracking-wide">Popular Searches:</p>
                    <div class="flex flex-wrap gap-3">
                        <div class="suggestion-chip px-4 py-3 rounded-xl text-sm font-medium" onclick="setSuggestion('Best phones under ₹20,000')">
                            <i class="fas fa-rupee-sign mr-2"></i>Under ₹20K
                        </div>
                        <div class="suggestion-chip px-4 py-3 rounded-xl text-sm font-medium" onclick="setSuggestion('Gaming phones with 8GB RAM')">
                            <i class="fas fa-gamepad mr-2"></i>Gaming Phones
                        </div>
                        <div class="suggestion-chip px-4 py-3 rounded-xl text-sm font-medium" onclick="setSuggestion('Best camera phone 2024')">
                            <i class="fas fa-camera mr-2"></i>Best Camera
                        </div>
                        <div class="suggestion-chip px-4 py-3 rounded-xl text-sm font-medium" onclick="setSuggestion('Long battery life phones')">
                            <i class="fas fa-battery-full mr-2"></i>Long Battery
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Loading Indicator -->
        <div id="loader" class="hidden mb-12">
            <div class="text-center mb-8">
                <div class="loading-bar rounded-full mb-4 mx-auto max-w-2xl"></div>
                <div class="flex items-center justify-between text-gray-400 text-sm max-w-2xl mx-auto">
                    <span>Processing your request...</span>
                    <span id="loadingStep">Initializing AI</span>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="glass-card p-6 rounded-2xl animate-pulse">
                    <div class="h-7 bg-gray-700 rounded w-3/4 mb-4"></div>
                    <div class="h-4 bg-gray-700 rounded w-full mb-3"></div>
                    <div class="h-4 bg-gray-700 rounded w-5/6"></div>
                </div>
                <div class="glass-card p-6 rounded-2xl animate-pulse">
                    <div class="h-7 bg-gray-700 rounded w-3/4 mb-4"></div>
                    <div class="h-4 bg-gray-700 rounded w-full mb-3"></div>
                    <div class="h-4 bg-gray-700 rounded w-5/6"></div>
                </div>
                <div class="glass-card p-6 rounded-2xl animate-pulse">
                    <div class="h-7 bg-gray-700 rounded w-3/4 mb-4"></div>
                    <div class="h-4 bg-gray-700 rounded w-full mb-3"></div>
                    <div class="h-4 bg-gray-700 rounded w-5/6"></div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <section id="resultsSection">
            <div id="results" class="space-y-8" aria-live="polite"></div>
        </section>
    </div>

    <!-- Enhanced Footer -->
    <footer class="mt-20 py-8 relative z-10 border-t border-gray-800/50">
        <div class="container max-w-7xl mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="text-gray-500 text-sm mb-4 md:mb-0">
                    <div class="flex items-center space-x-4">
                        <span class="flex items-center">
                            <i class="fas fa-brain mr-2 text-indigo-400"></i>
                            Powered by Advanced AI
                        </span>
                        <div class="w-1 h-1 bg-gray-600 rounded-full"></div>
                        <span class="flex items-center">
                            <i class="fas fa-shopping-cart mr-2 text-blue-400"></i>
                            Data from Flipkart
                        </span>
                    </div>
                </div>
                <div class="text-gray-400 text-sm flex items-center">
                    <span>Created with</span>
                    <i class="fas fa-heart text-red-400 mx-2"></i>
                    <span>by</span>
                    <span class="ml-1 font-semibold text-indigo-300">Bhupen</span>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // ... (keep all your existing JavaScript functions exactly as they were)
        // Set suggestion function
        function setSuggestion(text) {
            document.getElementById('queryInput').value = text;
            document.getElementById('queryInput').focus();
        }

        // Enhanced loading animation
        function simulateLoading() {
            const steps = [
                "Analyzing your query...",
                "Searching Flipkart database...",
                "Filtering results...",
                "Generating recommendations...",
                "Almost done..."
            ];
            
            let step = 0;
            const interval = setInterval(() => {
                if (step < steps.length) {
                    document.getElementById('loadingStep').textContent = steps[step];
                    document.querySelector('.loading-bar').style.width = `${(step + 1) * 20}%`;
                    step++;
                } else {
                    clearInterval(interval);
                }
            }, 600);
            
            return interval;
        }

        // Function to redirect to Flipkart search
        function searchFlipkart(phoneModel) {
            // Clean the model name for URL
            const cleanModel = phoneModel
                .replace(/[^\w\s\-]/gi, '')  // Keep hyphens for model numbers
                .replace(/\s+/g, '+')        // Replace spaces with +
                .replace(/\++/g, '+')        // Remove duplicate +
                .trim();
            
            // Create Flipkart search URL
            const flipkartUrl = `https://www.flipkart.com/search?q=${cleanModel}+mobile`;
            
            // Open in new tab
            window.open(flipkartUrl, '_blank');
            
            // Show notification
            showNotification(`Searching for ${phoneModel} on Flipkart...`, 'success');
        }

        async function fetchRecommendations() {
            const queryInput = document.getElementById('queryInput');
            const submitButton = document.getElementById('submitButton');
            const loader = document.getElementById('loader');
            const resultsDiv = document.getElementById('results');
            const query = queryInput.value.trim();

            if (!query) {
                showNotification('Please enter a query to find phones.', 'error');
                return;
            }

            // Show loading state
            loader.classList.remove('hidden');
            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Analyzing...';
            resultsDiv.innerHTML = '';

            // Start loading animation
            const loadingInterval = simulateLoading();

            try {
                const response = await fetch('/api/recommend', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query })
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch recommendations');
                }

                const data = await response.json();
                
                // Clear loading animation
                clearInterval(loadingInterval);
                loader.classList.add('hidden');
                submitButton.disabled = false;
                submitButton.innerHTML = '<i class="fas fa-robot mr-2"></i> Find Phones';

                console.log('API Response:', data); // Debug log

                if (!data.answer || data.answer.trim() === '') {
                    resultsDiv.innerHTML = `
                        <div class="text-center py-12 fade-in">
                            <i class="fas fa-search fa-4x text-gray-600 mb-6"></i>
                            <h3 class="text-2xl font-bold text-white mb-3">No phones found</h3>
                            <p class="text-gray-400 text-lg">Try adjusting your search terms or explore different categories</p>
                        </div>
                    `;
                    return;
                }

                // Parse and display results with card formatting
                displayCardResults(data.answer, resultsDiv);
                
                // Show success notification
                showNotification('Found perfect matches for you!', 'success');
                
            } catch (error) {
                // Clear loading animation
                clearInterval(loadingInterval);
                loader.classList.add('hidden');
                submitButton.disabled = false;
                submitButton.innerHTML = '<i class="fas fa-robot mr-2"></i> Find Phones';
                
                showNotification(`Error: ${error.message}`, 'error');
                console.error('Error:', error);
            }
        }

        function displayCardResults(answer, container) {
            console.log('Raw answer:', answer); // Debug log
            
            // Clean up the answer
            let cleanAnswer = answer
                .replace(/\*\*/g, '')
                .replace(/\*/g, '')
                .replace(/Memory: nan/g, 'Memory: Not specified')
                .replace(/Rating: nan/g, 'Rating: Not rated')
                .replace(/Price: ₹nan/g, 'Price: Not available')
                .replace(/Color: nan/g, 'Color: Various')
                .replace(/Storage: nan/g, 'Storage: Not specified');

            const lines = cleanAnswer.split('\n').filter(line => line.trim());
            
            console.log('Cleaned lines:', lines); // Debug log
            
            let html = '';
            let phoneCount = 0;

            // NEW: Parse cards that are on single lines
            const cardRegex = /┌─ PHONE CARD ─+┐(.*?)└─+┘/gs;
            const cards = [];
            let match;

            // Reset regex lastIndex
            cardRegex.lastIndex = 0;
            
            // Find all card blocks in the text
            while ((match = cardRegex.exec(cleanAnswer)) !== null) {
                const cardContent = match[1];
                // Split card content by lines and filter out empty lines and border characters
                const cardLines = cardContent.split('│')
                    .map(line => line.trim())
                    .filter(line => line && !line.includes('─') && !line.includes('┌') && !line.includes('└'));
                
                if (cardLines.length > 0) {
                    cards.push(cardLines);
                }
            }

            console.log('Cards found:', cards.length, cards); // Debug log

            if (cards.length > 0) {
                // Display cards in a grid
                html += `
                    <div class="flex items-center justify-between mb-8 slide-in">
                        <h2 class="text-3xl font-bold text-white section-title">
                            <i class="fas fa-star mr-3 text-yellow-400"></i>
                            Recommended Phones
                        </h2>
                        <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-4 py-2 rounded-full text-sm font-bold shadow-lg">
                            ${cards.length} Phones Found
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8">
                `;

                // Generate card HTML for each phone
                cards.forEach((cardLines, index) => {
                    phoneCount++;
                    html += createPhoneCardFromLines(cardLines, phoneCount, index);
                });

                html += '</div>'; // Close grid

            } else {
                // Fallback to other parsing methods
                const hasNumberedList = lines.some(line => /^\d+\.\s+/.test(line));
                const hasPhoneKeywords = lines.some(line => 
                    line.toLowerCase().includes('samsung') || 
                    line.toLowerCase().includes('iphone') ||
                    line.toLowerCase().includes('oneplus') ||
                    line.toLowerCase().includes('xiaomi') ||
                    line.toLowerCase().includes('oppo') ||
                    line.toLowerCase().includes('vivo') ||
                    line.toLowerCase().includes('realme') ||
                    line.toLowerCase().includes('motorola')
                );

                if (hasNumberedList) {
                    html += createResultsHeader('Recommended Phones', lines);
                    html += parseNumberedList(lines);
                } else if (hasPhoneKeywords) {
                    html += createResultsHeader('Recommended Phones', lines);
                    html += parseFreeTextPhones(lines);
                } else {
                    html = `
                        <div class="phone-card rounded-2xl p-8 fade-in">
                            <div class="answer-content text-gray-300 text-lg leading-relaxed">
                                ${formatTextResponse(cleanAnswer)}
                            </div>
                        </div>
                    `;
                }
            }

            container.innerHTML = html;
            
            // Smooth scroll to results
            setTimeout(() => {
                document.getElementById('resultsSection').scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
            }, 500);
        }

        function createPhoneCardFromLines(cardLines, phoneNumber, index) {
            let model = 'Phone Model';
            let price = 'Price not available';
            let specs = [];

            cardLines.forEach(line => {
                if (line.toLowerCase().includes('model:')) {
                    model = line.replace(/model:/gi, '').trim();
                } else if (line.toLowerCase().includes('price:')) {
                    price = line.replace(/price:/gi, '').trim();
                } else if (line.includes(':')) {
                    specs.push(line);
                }
            });

            // Clean up duplicate "Rating:" text
            specs = specs.map(spec => spec.replace('Rating: Rating:', 'Rating:'));

            return `
                <div class="phone-card rounded-2xl p-6 fade-in" style="animation-delay: ${index * 0.1}s">
                    <div class="flex justify-between items-start mb-6">
                        <div class="flex items-center">
                            <div class="result-counter text-white mr-4">${phoneNumber}</div>
                            <h3 class="text-xl font-bold text-white">${model}</h3>
                        </div>
                        <div class="price-tag">${price}</div>
                    </div>
                    <div class="specs-grid">
                        ${specs.map(spec => {
                            const [key, value] = spec.split(':').map(s => s.trim());
                            if (!key || !value) return '';
                            return `
                                <div class="spec-item">
                                    <div class="spec-label">${key}</div>
                                    <div class="spec-value">${value}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    <div class="mt-6 pt-5 border-t border-gray-600/50">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400 text-sm font-medium">Verified Data</span>
                            <button onclick="searchFlipkart('${model}')" class="flipkart-button text-white font-semibold py-3 px-6 rounded-xl flex items-center transition-all duration-300 text-sm">
                                <i class="fas fa-external-link-alt mr-2"></i>
                                View on Flipkart
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function createResultsHeader(title, lines) {
            let phoneCount = 0;
            const phoneIndicators = lines.filter(line => 
                /^\d+\.\s+/.test(line) || 
                line.includes('┌─ PHONE CARD') ||
                /(samsung|iphone|oneplus|xiaomi|oppo|vivo|realme|motorola).*₹\d+/i.test(line)
            ).length;
            
            phoneCount = Math.max(1, phoneIndicators);

            return `
                <div class="flex items-center justify-between mb-8 slide-in">
                    <h2 class="text-3xl font-bold text-white section-title">
                        <i class="fas fa-mobile-alt mr-3"></i>
                        ${title}
                    </h2>
                    <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-4 py-2 rounded-full text-sm font-bold shadow-lg">
                        ${phoneCount} Phones Found
                    </div>
                </div>
            `;
        }

        function parseNumberedList(lines) {
            let html = '';
            let currentPhone = null;
            let phoneCount = 0;

            lines.forEach((line, index) => {
                const phoneMatch = line.match(/^(\d+)\.\s+(.+?)\s*\(?Selling Price:?\s*₹?([\d,]+)\)?/i);
                
                if (phoneMatch) {
                    if (currentPhone) {
                        html += currentPhone + '</div></div>';
                    }
                    
                    phoneCount++;
                    const [, number, model, price] = phoneMatch;
                    currentPhone = `
                        <div class="phone-card rounded-2xl p-6 fade-in mb-8" style="animation-delay: ${phoneCount * 0.1}s">
                            <div class="flex justify-between items-start mb-6">
                                <div class="flex items-center">
                                    <div class="result-counter text-white mr-4">${number}</div>
                                    <h3 class="text-xl font-bold text-white">${model.trim()}</h3>
                                </div>
                                <div class="price-tag">₹${price}</div>
                            </div>
                            <div class="specs-grid">
                    `;
                } else if (line.includes(':') && currentPhone) {
                    const [key, value] = line.split(':').map(s => s.trim());
                    if (key && value) {
                        currentPhone += `
                            <div class="spec-item">
                                <div class="spec-label">${key}</div>
                                <div class="spec-value">${value}</div>
                            </div>
                        `;
                    }
                }
            });

            if (currentPhone) {
                html += currentPhone + '</div></div>';
            }

            return html;
        }

        function parseFreeTextPhones(lines) {
            let html = '';
            let currentPhone = [];
            let phoneCount = 0;

            lines.forEach((line, index) => {
                const trimmed = line.trim();
                
                const isPhoneLine = /(samsung|iphone|oneplus|xiaomi|oppo|vivo|realme|motorola|poco|nokia|asus|lg|sony)/i.test(trimmed) ||
                                   /₹\d+[,]?\d+/.test(trimmed) ||
                                   /\d+GB\s+(RAM|Storage)/i.test(trimmed);

                if (isPhoneLine && trimmed.length > 10) {
                    if (currentPhone.length > 0) {
                        phoneCount++;
                        html += createSimplePhoneCard(currentPhone, phoneCount);
                        currentPhone = [];
                    }
                    currentPhone.push(trimmed);
                } else if (currentPhone.length > 0 && trimmed.length > 5) {
                    currentPhone.push(trimmed);
                }
            });

            if (currentPhone.length > 0) {
                phoneCount++;
                html += createSimplePhoneCard(currentPhone, phoneCount);
            }

            return html;
        }

        function createSimplePhoneCard(phoneLines, phoneNumber) {
            const title = phoneLines[0] || 'Smartphone';
            const specs = phoneLines.slice(1).filter(line => line.length > 5);
            
            return `
                <div class="phone-card rounded-2xl p-6 fade-in mb-8" style="animation-delay: ${phoneNumber * 0.1}s">
                    <div class="flex justify-between items-start mb-6">
                        <div class="flex items-center">
                            <div class="result-counter text-white mr-4">${phoneNumber}</div>
                            <h3 class="text-xl font-bold text-white">${title}</h3>
                        </div>
                    </div>
                    <div class="specs-grid">
                        ${specs.map(spec => {
                            const colonIndex = spec.indexOf(':');
                            if (colonIndex > -1) {
                                const key = spec.substring(0, colonIndex).trim();
                                const value = spec.substring(colonIndex + 1).trim();
                                return `
                                    <div class="spec-item">
                                        <div class="spec-label">${key}</div>
                                        <div class="spec-value">${value}</div>
                                    </div>
                                `;
                            } else {
                                return `
                                    <div class="spec-item">
                                        <div class="spec-label">Feature</div>
                                        <div class="spec-value">${spec}</div>
                                    </div>
                                `;
                            }
                        }).join('')}
                    </div>
                    <div class="mt-6 pt-5 border-t border-gray-600/50">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400 text-sm font-medium">Verified Data</span>
                            <button onclick="searchFlipkart('${title}')" class="flipkart-button text-white font-semibold py-3 px-6 rounded-xl flex items-center transition-all duration-300 text-sm">
                                <i class="fas fa-external-link-alt mr-2"></i>
                                View on Flipkart
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function formatTextResponse(text) {
            return text
                .split('\n')
                .map(line => {
                    const trimmed = line.trim();
                    if (!trimmed) return '<br>';
                    if (/^[•\-]\s/.test(trimmed)) {
                        return `<div class="flex items-start mb-3">
                            <i class="fas fa-circle text-xs text-indigo-400 mt-2 mr-3 flex-shrink-0"></i>
                            <span class="text-gray-300">${trimmed.substring(2)}</span>
                        </div>`;
                    }
                    return `<p class="mb-4 text-gray-300">${trimmed}</p>`;
                })
                .join('');
        }

        function showNotification(message, type) {
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }

            const notification = document.createElement('div');
            notification.className = `notification fixed top-6 right-6 z-50 px-6 py-4 rounded-2xl shadow-2xl transform transition-all duration-300 ${
                type === 'error' ? 'bg-red-500' : 'bg-gradient-to-r from-green-500 to-emerald-600'
            } text-white font-semibold slide-in`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        // Event listeners
        document.getElementById('queryInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                fetchRecommendations();
            }
        });

        document.getElementById('queryInput').addEventListener('focus', function() {
            this.parentElement.classList.add('ring-2', 'ring-indigo-500', 'ring-opacity-50');
        });

        document.getElementById('queryInput').addEventListener('blur', function() {
            this.parentElement.classList.remove('ring-2', 'ring-indigo-500', 'ring-opacity-50');
        });

        // Add some interactive elements
        document.addEventListener('DOMContentLoaded', function() {
            // Add subtle animation to stats cards
            const statsCards = document.querySelectorAll('.stats-card');
            statsCards.forEach((card, index) => {
                card.style.animationDelay = `${index * 0.2}s`;
                card.classList.add('fade-in');
            });
        });
    </script>
</body>
</html>